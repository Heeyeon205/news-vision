<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>ì•„í‹°í´</title>
    <link rel="stylesheet" href="/css/common.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        #article-list {
            margin-top: 20px;
            padding: 10px;
        }

        .news-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            border: 1px solid #ccc;
            padding: 16px;
            margin-bottom: 12px;
            background-color: #fdfdfd;
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.05);
        }

        .news-item img {
            width: 120px;
            height: auto;
            object-fit: cover;
            border-radius: 4px;
        }

        .news-item h3 {
            margin: 0;
            font-size: 18px;
        }

        .news-item span {
            display: block;
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>

<header>
    <nav>
        <button onclick="location.href='/'">ë¡œê³ </button>
        <button class="active">ì•„í‹°í´</button>
        <button>AI ìš”ì•½</button>
        <button>ì»¤ë®¤ë‹ˆí‹°</button>
        <input type="text" placeholder="ê²€ìƒ‰ì°½">
        <button>ì•Œë¦¼</button>
        <button th:text="${nickname}">ë‹‰ë„¤ì„</button>
        <button>ë¡œê·¸ì¸</button>
    </nav>
</header>

<main>
    <h2>ì•„í‹°í´</h2>
    <p>{ì–´ë“œë¯¼ & í¬ë¦¬ì—ì´í„° ë‰´ìŠ¤ | ì¹´í…Œê³ ë¦¬ í˜ì´ì§€}</p>

    <!-- í•„í„° -->
    <div class="filter-bar">
        <button onclick="changeType('recent')">ì „ì²´</button>
        <button onclick="changeType('popular')">ì¸ê¸°ìˆœ</button>
        <button onclick="changeType('follow')">íŒ”ë¡œìš°</button>
        <button onclick="changeCategory(1)">ì¹´í…Œ 1</button>
        <button onclick="changeCategory(2)">ì¹´í…Œ 2</button>
        <button onclick="changeCategory(3)">ì¹´í…Œ 3</button>
    </div>

    <!-- ë‰´ìŠ¤ ë¦¬ìŠ¤íŠ¸ -->
    <div id="article-list"></div>
</main>

<footer>
    <p>í‘¸í„°</p>
</footer>

<script>
    let page = 0;
    let isLoading = false;
    let currentType = 'recent';
    let currentCategoryId = null;

    function loadArticles() {
        if (isLoading) return;
        isLoading = true;

        let url = `/api/article?type=${currentType}&page=${page}`;
        if (currentType === 'category' && currentCategoryId) {
            url += `&id=${currentCategoryId}`;
        }

        fetch(url)
            .then(res => res.json())
            .then(result => {
                console.log("ğŸš€ ì‘ë‹µ í™•ì¸:", result.data);
                if (result.success && result.data.content.length > 0) {
                    const list = document.getElementById("article-list");
                    result.data.content.forEach(news => {
                        const item = document.createElement("div");
                        item.classList.add("news-item");
                        item.innerHTML = `
                  <img src="${news.image}" alt="ì¸ë„¤ì¼">
                  <div>
                      <span>${news.category}</span>
                      <h3>${news.title}</h3>
                      <div>
                          <span>${news.author}</span>
                          <span>${new Date(news.createdAt).toLocaleDateString()}</span>
                      </div>
                  </div>
              `;
                        list.appendChild(item);
                    });

                    if (!result.data.last) {
                        page++;
                        isLoading = false;
                    }
                } else {
                    // ë¹ˆ ëª©ë¡ ì²˜ë¦¬
                    document.getElementById("article-list").innerHTML = "<p>í‘œì‹œí•  ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
                }
            });

    }

    function changeType(type) {
        page = 0;
        currentType = type;
        currentCategoryId = null;
        document.getElementById("article-list").innerHTML = "";
        loadArticles();
    }

    function changeCategory(id) {
        page = 0;
        currentType = 'category';
        currentCategoryId = id;
        document.getElementById("article-list").innerHTML = "";
        loadArticles();
    }

    // ë¬´í•œìŠ¤í¬ë¡¤
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
            loadArticles();
        }
    });

    // ì´ˆê¸° ë¡œë”©
    document.addEventListener('DOMContentLoaded', loadArticles);
</script>

</body>
</html>
